Obi fa√ßade API for iteration 2
$Id$


This new version of the facade is more a reaction to the current state of
the design and its implementation and how the application would like to see
it. This is still very sketchy but provides a starting point (and a laundry
list) for discussion. Order is not important but numbers allow to refer to
some points more easily.


1. Currently, the asset manager uses double for time whereas the toolkit
uses long. We need to make them agree.


2. Have a hash function for nodes that returns an unique value.


3. Have a method that returns a single channel given a name, a null value if
there is no channel with that name, and throw an exception if there is more
than one channel with that name (or return a null value.) This makes channel
management more enjoyable if we want only one channel with a given name at
any time.


4. More specfically, have a method that returns the media object for a node
set on a channel given its name. We probably need a mechanism for tying
media types to channels.


5. Allow empty strings (not null, but with a length of zero) for TextMedia.


6. Use delegates for visitor. I am using the C# terminology here, so it
should be formalized in the design by more neutral terminology. I propose
the following methods:

  IVisitableNode.VisitDepthFirst(delegate bool previsit(ICoreNode node));
  IVisitableNode.VisitDepthFirst(delegate bool previsit(ICoreNode node),
                                   delegate void postvisit(ICoreNode node));

This is so much more practical than creating a new class everytime we need a
slightly different visitor, especially when we need intimate access to the
current class (which can be solved by having the class itself implement
ICoreNodeVisitor, but it is a bit kludgy and works only once.)

Also, in my experience so far, there are many cases where only a previsitor
is necessary. We may even be able to specify

  IVisitableNode.VisitDepthFirst(delegate void postvisit(ICoreNode node));

if necessary. In the same way we could have VisitBreadthFirst() methods.

BTW, I am not necessarily saying the we should get rid of the visitor
interface, but in many cases I would rather use the delegates than a visitor
class.


7. Have metadata be accessible as a hash, with the name of the metadata
property as key, and a list of values as value (we may have several metadata
tags with the same name, e.g. several authors.)


8. Allow extra attributes for metadata (e.g. "role", see DC metadata for
DAISY 3.)


9. Have the C# toolkit use C# features: properties, generic classes (e.g.
node lists would be List<CoreNode> instead of ArrayList), delegates (see
visitors), etc.


10. Allow to change the NodeFactory of a presentation. I want to subclass
CoreNode, but not Presentation.


11. Project.openXUK() should return a meaningful error message when failing
to read in a XUK file.


12. Commands: so far in the application, we only create a new command if its
action was succesful, so we do not need predicates to test whether we can
undo or redo a method. The invariant of the command manager is that when a
command is undone, we go back to a state where redoing must succeed just
like it did when we issued the command. Same for redo.
