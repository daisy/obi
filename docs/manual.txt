# Reference manual for Obi 1.0

`$Id$`

<div id="toc">Table of contents</div>

Now this is really the reference section. If you're a user and not a
developper, you can ignore the items marked as TODO.

## Views

The work area of Obi is composed of several views, as described below. All
views (except for the strips view) can be shown or hidden as necessary.

### Strips view

The main view is the _strips view_. This is the view in which the contents of
the book are edited. There is a strip for every section in the book and they
appear in book order in the strips view. Inside each strip the actual contents
appear as blocks.

#### Strips

A _strip_ represents a section and its contents. Subsections are represented as
other strips that follow in the strip view. Contents are represented as blocks
which are shown in book order inside the strip. A strip fills the entire width
of the strips view and has two parts:

1. an editable label showing the title of the section;

2. a sequence of zero or more blocks.

#### Blocks

A _block_ is used to represent an unit of content in the strips view. A block
can be empty or contain audio. The audio content of a block is called a
_phrase_ as it allows for the reader to skip easily from phrase to phrase
when the book is exported to DAISY. Obi does not impose any limitations on
the amount of audio that a block may contain.

#### Different kinds of blocks

* _Empty blocks_ are blocks that contain no audio. They can be used as
  placeholders for adding audio at a later time. An empty block only contains
  an information label. TODO: describe contents of label; something like "block
  _n_ of _m_."

* _Plain blocks_ are blocks that contain audio. In addition to the information
  label, the waveform of the audio is displayed.

* _Page blocks_ are blocks that represent a page number. The corresponding
  phrase is usually a reading of the page number. An actual number is
  associated with the block. Example: page number 42 in the book can be
  represented by a page block bearing the number 42 and the phrase "page
  42." In the exported DAISY book, a page block will be skippable.

* _Silence blocks_ are used for phrase detection; see below.

* _Custom blocks_ are blocks that have some additional property in the current
  book (such as producer notes, side bars, etc.) These can be defined by the
  producer of the book as needed. In the exported DAISY book, custom blocks
  will be skippable.

__Note:__ future versions of Obi will have _container blocks_ that can hold
other blocks to create escapable structures, such as lists or audio tables,
but they are not included in the current release of Obi.

### TOC view

The _table of contents view_ (_TOC view_ for short) shows the table of contents
of the book in a hierarchical way. Each entry in the table of contents is
called a _section_; this is a generic Obi term, and can be a book part,
chapter, section, subsection, etc. The level of each section is shown by its
indentation. As noted above, there is a corresponding strip for every section
in the TOC view.

### Metadata view

The _metadata view_ shows the metadata of the book: information such as title,
narrator, date of publication, etc. Metadata entries can be edited in this
view.

### Transport bar and peak meter

The _transport bar_ is used for recording and playback of the book. It has
buttons such as play, record, or stop; a time display; and a textual peak
meter. In addition to the transport bar, an external peak meter can also be
shown alongside Obi's main window.


## Selection

All edits in Obi are based on the current selection. In the current version of
Obi, only a single selection can be made at once (future versions of Obi will
have multiple selection.)

In general, selection is performed by clicking (and possibly dragging) on the
object or area to select; keyboard users can navigate to the desired region
to select (see keyboard navigation below.)

### What is selectable?

* In the strips view:
  * A strip is selectable.
  * The label of a strip is selectable. When selected, the label becomes
    editable.
  * A position inside a strip is selectable. The position can be before the
    first block, after the last block, or between two blocks.
  * A block inside a strip is selectable.
  * The waveform in a block is selectable; either a position or a range of
    audio.
* In the TOC view:
  * A section is selectable.
  * The text label of a section is selectable. When selected, it becomes
    editable.
* In the metadata view:
  * A metadata entry in the metadata view is selectable (TODO).
  * The text inside a metadata entry is selectable (TODO). When selected, it
    becomes editable.

### Label editing

The label of a strip or a section, and the value of a metadata entry (TODO) can
be directly edited by clicking them. When typing `Enter`, the new name is
committed; typing `Esc` cancels the edit. Strips also have an `OK` and `Cancel`
button which achieve the same effects.

## Transport bar and peak meter

### Transport bar buttons

* __Play button__ (`Ctrl+Space`): this button gives Play All command while
starting playback from currently selected block in strip view or currently
selected node in tree view.
  * If there is no in phrase selection, (technically  termed as audio
  selection) this button starts playback from starting of selected block or
  selected tree node.
  * If there is Audio selection and cursor has a position marked inside
  phrase, this button starts playback from this cursor position.
  * TODO: `Ctrl+Space` doesn't seem to work? And should play all;
    `Ctrl+Shift+Space` to play selection (see menu)?

* __Pause button__ (`Space`): pause both playback as well as recording (which
  ever is active). Pause position and cursor position are synchronised with
  each other so pause position also acts as cursor position for operations
  like split and insert recording.

* __Stop button__: stop playback or recording which ever is active.


### Peak meter

## Menus

### File menu (`Alt+F`)

Creating and opening projects:

* __New project__ (`Ctrl+N`): create a new project. If there is a project
  currently open, Obi will attempt to close it first. A dialog is shown where
  the user can enter a title for the project and choose a location for saving
  it. TODO: add instructions in the dialog.

* __New project from import__ (`Ctrl+Shift+N`): create a new project by
 importing an XHTML file containing the structure of the project. You will
 have to choose a title (if different from the one given in the file) and
 a location for saving the project. TODO: better error handling (completely
 undo the import.)

(Missing commands)

* __Clean unreferenced audio__ (`Ctrl+L`): clean unreferenced audio from the
  project. Obi keeps unused audio data so that changes can be undone, but
  sometime there is audio data in the project that is not referenced anywhere
  (_i.e._, there is no phrase with this audio data, nor any command in the
  undo stack that concerns this data.) In order to save disk space, it is
  possible to clean the project by removing all this data. It is recommended
  to save right after cleaning the project, otherwise there may be problems
  when reopening the project. Cleaning the project at the beginning of the
  session makes sure that all of the data not referenced in the project itself
  has been removed.


### Edit menu (`Alt+E`)

Obi stores all executed commands in an _undo stack_ so that commands can be
undone later. All commands executed since the current project was loaded are
stored so an unlimited number of commands can be undone. Undone commands are
also stored in a _redo stack_ so that an undone command can be redone. Whenever
a new command is executed, the redo stack is cleared.

* __Undo__ (`Ctrl+Z`): undo the last executed command.
  * TODO: save the undo stack in the XUK file.
  * TODO: when the project reverts to the last saved state, mark it as
    unmodified.

* __Redo__ (`Ctrl+Y`): redo the last undone command.

Obi maintains a clipboard that contains the last cut or copied item. Undoing a
cut or copy operation restores the previous value of the clipboard.

* __Cut__ (`Ctrl+X`): delete the selected item (strip, section, block or audio)
  and place it in the clipboard. TODO: works for text as well, but only through
  shortcut; not well integrated.

* __Copy__ (`Ctrl+C`): copy the selected item (strip, section, block or audio)
  and place it in the clipboard. TODO: works for text as well, but only through
  shortcut; not well integrated.

* __Paste__ (`Ctrl+V`): paste the item from the clipboard in or after the
  selection.
  * If the clipboard contains a section node, it can be pasted after the
    selected section in the TOC view or the selected strip in the strip view.
  * If the clipboard contains a block, it can be pasted after the selected
    block, at the end of the selected strip, or at the selection point inside
    a strip. If the selection is a waveform cursor, then the audio of the block
    is inserted at that point; if it is a waveform selection, then the audio
    of the block is pasted in place of the selection.
  * If the clipboard contains audio, the audio can be pasted as a new block
    in the selected strip or at the selected point inside a strip, or at the
    end of the selected block. If the selection is a waveform cursor, then the
    audio is inserted at that point; if it is a waveform selection, then the
    audio is pasted in place of the selection.
  * TODO: text, yada yada.

* __Paste before__ (`Ctrl+Alt+V`): when a section is selected and a section is
  in the clipboard, paste the section from the clipbaord before the selected
  section and at the same level.

* __Paste inside__ (`Ctrl+Shift+V`): when a section is selected and a section
  is in the clipboard, paste the section from the clipboard as a subsection of
  the selected section. The child is added last.

* __Delete__ (`Del`): delete the selected item. If it is a section, then all
  subsections are deleted as well. If it is a strip, then only this strip is
  deleted. If the corresponding section has subsection, the first subsection
  is moved to the level of the deleted section so that the consistency of the
  TOC is preserved.

* __Select nothing__ (`Alt+N`): deselect any item that was selected.
  * TODO: change the keyboard shortcut.

In addition to cleaning up unreferenced audio data, it is possible to also
clean up _unused_ data from the project.

* __Delete unused data__ (`Ctrl+Shift+L`): delete all sections and phrases
  marked as being unused. This can be undone, just like any deletion in Obi.

Athough Obi is an audio editing tool, a large project can still contain a non
trivial amount of text (section headings, metadata, annotations) so a search
function is provided.

* __Find__ (`F3`): bring the search bar in focus and let the user type some
  text to find. The first item containing this text is selected (in the case
  of section titles, the strip corresponding to the section is selected.)

  * TODO: quick find with `/` as in `vi`.
  * TODO: search metadata.
  * TODO: buttons in the search bar (previous, next?)
  * TODO: replace?

### View menu (`Alt+V`)

* __Focus on Strips view__ (`F6`)

* __Show source view__ (`Alt+R`): show the source of the XUK file for this
  project. This is mainly useful for debugging and may be removed from the
  release version.
  * TODO: change keyboard shortcut.


### TOC menu (`Alt+C`)

The TOC menu provides operations on the table of contents.

* __Add section__ (`Ctrl+A`): add a new section after the selected section
  and at the same level. If no section is selected, then add a new section at
  the top level and at the end.

* __Ad sub-section__ (`Ctrl+Shift+A`): add a new section as the last child of
  the selected section.

* __Insert section__ (`Ctrl+Alt+A`): insert a new section before the selected
  section and at the same level.

* __Rename section__ (`F2`): start editing the label of the section. The new
  name cannot be empty. The change is committed when pressing `Return` or
  cancelled when pressing `Esc`.

* __Move section in__ (`Ctrl+Shift+Left`): increase the level of the section
  by one. The section becomes the first subsection of its previous sibling
  section; as a consequence, the first subsection of a section cannot be
  moved in. Only the section moves, not its subsections.

* __Move section out__ (`Ctrl+Shift+Right`): decrease the level of the section
  by one. Only sections without subsections can be moved out. Top-level
  sections can obviously not be moved out.

* __Section is used__ (`Ctrl+K`): when a section is selected, the menu
  item shows whether the section is used or not with a checkbox. The checkbox
  is checked if the section is currently used. Selecting this item toggles the
  used status of the section (from used to unused, and from unused to used.)
  When the used status of the section changes, all subsections change to the
  same status as well. The status of a section can only be changed if its
  parent section is used (or if it is a top-level section), as there cannot
  be used subsections of unused sections.


### Strips menu (`Alt+S`)

* __Add strip__ (`Ctrl+A`): add a new strip after the selected strip. The
  corresponding section will be at the same level as the section of the
  selected strip. If the section of the selected strip had subsections, they
  become subsections of the new section.

* __Insert strip__ (`Ctrl+Alt+A`): insert a new strip before the selected
  strip.

* __Rename strip__ (`F2`): start editing the label of the strip. The new name
  cannot be empty. The change is committed when pressing `Return` or cancelled
  when pressing `Esc`.

* __Split strip__ (`Ctrl+Shift+P`): split the strip at the selected position
  in the strip, or from the selected block. The new strip has the same label
  and level as the original strip, and all the blocks starting from the split
  position. If the first block or position is selected, there is no effect.

* __Merge strip with next__ (`Ctrl+Shift+M`): merge the selected strip with the
  next one; that is, all the blocks in the following strip are appended to the
  selected strip. The following strip is then removed from the project. If the
  following strip has a lower level than the selected strip, merging is not
  possible.

* __Strip is used__ (`Ctrl+K`): when a strip is selected, the menu
  item shows whether the strip is used or not with a checkbox. The checkbox
  is checked if the strip is currently used. Selecting this item toggles the
  used status of the strip (from used to unused, and from unused to used.)
  This operation can only be executed if the corresponding section has no
  subsection; _i.e._ if the operation affects only the selected strip. The
  contents of the strip are affected as well.


### Blocks menu (`Alt+B`)

* __Add empty block__ (`Ctrl+B`): add a new empty block at the end of the
  selected strip, or after the selected item in the strip.

* __Add empty page blocks__ (`Ctrl+Shift+B`): add one or more empty blocks
  with a page number.  A dialog opens where the user can choose the page
  number for the first block, the number of blocks to add, and whether to
  renumber subsequent page blocks automatically. The page number increases by
  one for each block (_e.g._ if three pages are added starting at page number
  4, the three page blocks will be numbered 4, 5 and 6) and for subsequent
  pages if the user chooses to renumber them (_e.g._ following pages would be
  renumbered 7, 8, 9, etc.)

* __Split block__ (`Ctrl+P`): split the block at the current cursor position.
  The block is split in two blocks, one with all the audio data before the
  cursor position, followed by one with the all the audio data after the cursor
  position.
  * TODO: handle different kinds gracefully.
  * TODO: how to split nested blocks?

* __Merge block with next__ (`Ctrl+M`): merge this audio block with the
  following block. The two blocks are replaced with a block that contains
  the audio of both blocks.
  * TODO: if the blocks were of a different kind, the kind of the first block
    is kept. This means that page numbers may disappear, etc.

* __Block is used__ (`Ctrl+K`): when a block is selected, the menu item shows
  whether the block is used or not with a checkbox. The checkbox is checked if
  the block is currently used. Selecting this item toggles the used status of
  the block (from used to unused, and from unused to used.)


### Transport menu (`Alt+R`)

* __Play__: playback sub-menu.
  * __Play all__ (Ctrl+Space): play from the current selection, or the
    beginning of the book if nothing is selected, until the end of the book is
    reached.
  * __Play selection__ (`Ctrl+Shift+Space`): play the current selection, or
    if a cursor is positionned inside a block, until the end of the block.

* __Pause/Resume__: pause or resume playback.

* __Stop__: stop playback.

* __Record__: recording sub-menu.
  * __Start listening__:
  * __Start recording__:
  * __Allow overwrite__:


### Tools menu

### Help menu
